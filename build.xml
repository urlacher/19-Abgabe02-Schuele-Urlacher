<?xml version="1.0" encoding="UTF-8"?>
<project name="SimpleAutomaticBuildProject">

  <!--Properties-->
    <property name="project.name"   value="${ant.project.name}"/>
    <property name="jar-name"       value="${project.name}.jar"/>
    <property name="version"        value="1.0"/>

    <!--Outsourced Properties in case the .build.properties is not available-->
    <property name="w.dir"              value="."/>
    <property name="src.dir"            value="${w.dir}/src"/>
    <property name="lib.dir"            value="${w.dir}/dist"/>
    <property name="mvn.project.name"   value="SimpleAutomaticBuildProject"/>
    <property name="simpleAut.src.main.java.dir" value="${mvn.project.name}/src/main/java"/>
    <property name="build-ant.dir"      value="${w.dir}/build-ant"/>
    <property name="package.name"       value="at.fhj.iit"/>
    <property name="main-class"         value="Main.class"/>
    <property name="name.arg"           value=""/>
    <!--Checks if mvn.project.name exist if it exist mvn.project.exist is set to true-->
    <target name="mvn.check">
        <echo message="Prove if ${mvn.project.name} exist."/>
        <condition property="mvn.project.exist">
            <and>
                <available file="${mvn.project.name}" type="dir"/>
            </and>
        </condition>
    </target>

    <!--If mvn.project.exist is true the directory in src/main/java is past into the src directory
        else this target does't run-->
    <target     name="convertMVN" 
                depends="mvn.check" 
                if="mvn.project.exist">
        <echo message="${mvn.project.name} exist."/>
        <mkdir dir="${src.dir}"/>
        <copy  todir="${src.dir}">
            <fileset    dir="${simpleAut.src.main.java.dir}" 
                        includes="**/*.java" 
                        excludes="**/test/**"/>
        </copy>
    </target>

    
  <!-- Initilize the Ant directory structure -->
    <target     name="init" 
                depends="convertMVN"
                description="create directory">
        <mkdir dir="${lib.dir}"/>
        <mkdir dir="${build-ant.dir}"/>
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="${src.dir}"/>
        
    </target>
  
   <!--Compile all .java files which are in the src directory and place the .class files in the build-ant directory -->
    <target     name="compile"
                depends="init" 
                description="Compile the class files into ${build-ant.dir}">

        <javac  destdir="${build-ant.dir}" debug="false"   includeantruntime="false">
            <src path="${src.dir}"/>
        </javac>
    </target>
  <!--Create a Java-Archive of all .class files which are located in the build-ant directory exluding the Test.class-->
    <target     name="jar"
                depends="compile"
                description="Creates a Jar-file of the compiled Classes.">

        <jar    destfile="${lib.dir}/${jar-name}"
                basedir="${build-ant.dir}"
                excludes = "**/Test.class">

            <manifest>
                <attribute  name="Main-Class"               value="${package.name}.Main"/>
                <attribute  name="Implementation-Author"    value="${user.name}" />
                <attribute  name="Implementation-Version"   value="${version}" />
                <attribute  name="Implementation-Title"     value="${ant.project.name}" />
            </manifest>

        </jar>
   </target>
  <!-- removes same directories which created by init target -->
  <target name="clean">
	<!-- read more about ant tasks in general: https://ant.apache.org/manual/tasksoverview.html -->
	<!-- read more about delete task in detail: https://ant.apache.org/manual/Tasks/delete.html -->
  	<delete dir="build-ant"/>
  </target>
  

</project>